#!/bin/bash

set -e

DEBIAN_FRONTEND=noninteractive

apt-get -y update

# Getting python 2.7
apt-get install -y python2.7 python2.7-dev
apt-get install -y python-pip
pip install --upgrade pip

# Same thing but now for python 3.4
apt-get install -y python3.4 python3.4-dev
apt-get install -y python3-pip
pip3 install --upgrade pip

# Install dependencies
apt-get install -u -y unzip wget git-core \
    pkg-config libblas-dev liblapack-dev libpng-dev libjpeg8-dev libfreetype6-dev \
    libatlas-base-dev gfortran \
    python-numpy  python-scipy  python-sklearn \
    python3-numpy python3-scipy


pip3 install sklearn

pip install pandas
pip3 install pandas

# Install Anaconda for Python2
wget https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda2-4.0.0-Linux-x86_64.sh --no-check-certificate # TODO: CHECK SSL CERTIFICATE
bash Anaconda2-4.0.0-Linux-x86_64.sh -b -p /opt/anaconda2
rm /opt/anaconda2/bin/curl /opt/anaconda2/bin/curl-config
export PATH=/opt/anaconda2/bin:$PATH
/opt/anaconda2/bin/conda install nomkl

/opt/anaconda2/bin/pip install --upgrade pip
/opt/anaconda2/bin/pip install pylab pil-compat cvxopt python-dateutil joblib simplejson

# Steps to get open CV (from: http://docs.opencv.org/2.4/doc/tutorials/introduction/linux_install/linux_install.html#linux-installation)
apt-get install -y build-essential
apt-get install -y cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
apt-get install -y libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev

ORIG_DIR=`pwd`
mkdir /tmp/opencv
cd /tmp/opencv

git clone https://github.com/Itseez/opencv.git
cd opencv
git checkout d3930cdee1a0c7124045883b3062f25b3027fa97

mkdir build
cd build

cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local ..
make
sudo make install

cd $ORIG_DIR

# Install Anaconda for Python3
wget https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda3-4.0.0-Linux-x86_64.sh --no-check-certificate # TODO: CHECK SSL CERTIFICATE
bash Anaconda3-4.0.0-Linux-x86_64.sh -b -p /opt/anaconda3
rm /opt/anaconda3/bin/curl /opt/anaconda3/bin/curl-config
export PATH=/opt/anaconda3/bin:$PATH
/opt/anaconda3/bin/conda install nomkl

/opt/anaconda3/bin/pip install --upgrade pip
/opt/anaconda3/bin/pip install pylab pil-compat cvxopt python-dateutil joblib simplejson

apt-get install -y libx11-dev # You need this if you want to include <X11/Xlib.h>
apt-get install -y libgdal-dev # You need this if you want to include gdal.h

