#!/bin/bash

set -e

LANGS=(ruby python javascript rust)

function build_base_images {
	cargo build --release
  docker build -f Dockerfile.runner -t algorithmia/langserver .
	docker build -f Dockerfile.builder -t algorithmia/langbuilder .
}

function build_lang_images {
  build_base_images
  for lang in $@; do
    cd $lang
    echo "=====Begin building langserver-$lang====="
		docker build -f Dockerfile.runner -t algorithmia/langserver-$lang .
    echo "=====Finished building langserver-$lang====="
    echo "=====Begin building langbuilder-$lang====="
		docker build -f Dockerfile.builder -t algorithmia/langbuilder-$lang .
    echo "=====Finished building langserver-$lang====="
    cd ..
  done
}

function build_single_image {
  docker build -f Dockerfile.single-runner -t algorithmia/langserver-single .
}

case $1 in
    langserver )
        build_base_images ;;
    all )
        build_lang_images $LANGS  ;;
    single )
        build_single_image ;;
    * )
        build_lang_images $@;;
esac

